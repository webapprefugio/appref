<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cadastro AppRef</title>
</head>
<body>
  <h2>Cadastro de Acesso</h2>

  <input type="email" id="txtEmail" placeholder="Email"><br>
  <input type="password" id="txtSenha" placeholder="Senha"><br>

  <select id="lstUf">
    <option value="">Selecione um estado</option>
  </select><br>

  <select id="lstCidade">
    <option value="">Selecione uma cidade</option>
  </select><br>

  <input type="url" id="lnkLinkPerfilSocial" placeholder="Link da rede social"><br>

  <label>
    <input type="checkbox" id="check"> Li e aceito os termos
  </label><br><br>

  <button onclick="salvarDados()">Cadastrar</button>
  <button onclick="limparFormulario()">Cancelar</button>

  <p id="mensagem"></p>

  <!-- Firebase SDK versÃ£o 8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCzg9Pr8-7UGv7f451Vx30WpzwRcsGd_qs",
      authDomain: "appref-projeto.firebaseapp.com",
      projectId: "appref-projeto",
      storageBucket: "appref-projeto.appspot.com",
      messagingSenderId: "80380853942",
      appId: "1:80380853942:web:2320fa16fa06f2ffa77017"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const lstUf = document.getElementById("lstUf");
    const lstCidade = document.getElementById("lstCidade");

    const estados = [
      "AC","AL","AM","AP","BA","CE","DF","ES","GO","MA",
      "MG","MS","MT","PA","PB","PE","PI","PR","RJ","RN",
      "RO","RR","RS","SC","SE","SP","TO"
    ];

    // Preenche lista de UFs
    estados.forEach(uf => {
      const opt = document.createElement("option");
      opt.value = uf;
      opt.textContent = uf;
      lstUf.appendChild(opt);
    });

    // Carrega cidades de acordo com o estado
    lstUf.addEventListener("change", () => {
      const uf = lstUf.value;
      lstCidade.innerHTML = '<option value="">Carregando cidades...</option>';

      fetch(`./cidades/${uf.toLowerCase()}.json`)
        .then(res => res.json())
        .then(data => {
          lstCidade.innerHTML = '<option value="">Selecione uma cidade</option>';
          data.cidades.forEach(nome => {
            const opt = document.createElement("option");
            opt.value = nome;
            opt.textContent = nome;
            lstCidade.appendChild(opt);
          });
        })
        .catch(err => {
          console.error("Erro ao carregar cidades:", err);
          lstCidade.innerHTML = '<option value="">Erro ao carregar cidades</option>';
        });
    });

    async function salvarDados() {
      const email = document.getElementById("txtEmail").value.trim();
      const senha = document.getElementById("txtSenha").value.trim();
      const uf = lstUf.value;
      const cidade = lstCidade.value;
      const link = document.getElementById("lnkLinkPerfilSocial").value.trim();
      const aceitou = document.getElementById("check").checked;

      if (!email || !senha || !uf || !cidade || !link || !aceitou) {
        document.getElementById("mensagem").textContent = "Preencha todos os campos e aceite os termos.";
        return;
      }

      try {
        await db.collection("usuarios").add({
          email,
          senha,
          uf,
          cidade,
          linkPerfil: link,
          criadoEm: new Date()
        });
        document.getElementById("mensagem").textContent = "Cadastro realizado com sucesso!";
        limparFormulario();
      } catch (erro) {
        console.error("Erro:", erro);
        document.getElementById("mensagem").textContent = "Erro ao cadastrar.";
      }
    }

    function limparFormulario() {
      document.getElementById("txtEmail").value = "";
      document.getElementById("txtSenha").value = "";
      lstUf.value = "";
      lstCidade.innerHTML = '<option value="">Selecione uma cidade</option>';
      document.getElementById("lnkLinkPerfilSocial").value = "";
      document.getElementById("check").checked = false;
    }
  </script>
</body>
</html>